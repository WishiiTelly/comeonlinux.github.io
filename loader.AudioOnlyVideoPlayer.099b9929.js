"use strict";(self.webpackChunk_twitter_responsive_web=self.webpackChunk_twitter_responsive_web||[]).push([["loader.AudioOnlyVideoPlayer"],{92462:(t,e,a)=>{a.d(e,{Tc:()=>u,yt:()=>c});a(36728),a(6886);var n=a(67502),i=a(6556),l=a(55249),o=a(39466),r=a(1206);const s={autoplayPrioritizationPolicy:a(17323).Qr,minimumVisibilityForAutoplay:.25};class c{constructor(t=s){this._players=[],this._setPlayerState=(t,e)=>{t.previousPlaybackState=t.playbackState,t.playbackState=e},this._updatePlaybackStates=()=>{const t=this._players.find((t=>t.playbackState===i.q.USER_PLAYING&&t.playbackPriority!==i.W.SPACE));t&&!this._canPlay(t)?(this._pausePlayer(t),this._triggerAutoplay()):t?this._stopAllExcept(t):this._triggerAutoplay()},this._scheduleUpdate=n.canUseDOM?(0,o.Z)((0,l.Z)(this._updatePlaybackStates,window.requestIdleCallback?t=>window.requestIdleCallback(t,{timeout:200}):window.requestAnimationFrame),300,{leading:!1,trailing:!0}):r.Z;const{autoplayPrioritizationPolicy:e,minimumVisibilityForAutoplay:a}=t;this._autoplayPrioritizationPolicy=e,this._minimumVisibilityForAutoplay=a}register({autoplayGroupOptions:t,canAutoplay:e,onAutoPlayRequest:a,onFullscreenEntered:n,onFullscreenExited:l,onPauseRequest:o,isLooping:r,playbackPriority:s=i.W.NORMAL}){const c={autoplayGroupEmitter:null==t?void 0:t.autoplayGroupEmitter,placement:void 0,playbackPriority:s,playbackState:i.q.INITIAL,previousPlaybackState:i.q.INITIAL,commandHandlers:{onAutoPlayRequest:a,onFullscreenEntered:n,onFullscreenExited:l,onPauseRequest:o},canAutoplay:e&&s!==i.W.INELIGIBLE,isLooping:r};return t&&t.autoplayGroupEmitter.registerAutoplayGroupPlayer(c,t.mediaIndex),this._players.push(c),{reset:()=>this._handleReset(c),signalFullscreenChange:t=>this._handleFullscreenChanged(t),signalPlacementChange:t=>this._handlePlacementChange(c,t),signalPlay:()=>this._handlePlay(c),signalPause:()=>this._handlePause(c),signalPlaybackFinish:t=>this._handlePlaybackFinished(c,t),signalPlaybackPriorityChange:(t,e)=>this._handlePlaybackPriorityChange(c,t,e),unregister:()=>this._handleUnregister(c)}}_handleFullscreenChanged(t){this._players.forEach((e=>{const{onFullscreenEntered:a,onFullscreenExited:n}=e.commandHandlers;t&&a?a():!t&&n&&n()}))}_handlePlacementChange(t,e){const a=e.scrollY();t.placement=e,this._scrollY!==a&&(this._scrollY=a),t.playbackState===i.q.FINISHED&&0===e.visibleFraction()&&this._setPlayerState(t,i.q.INITIAL),this._scheduleUpdate()}_handlePlay(t){t.playbackState!==i.q.AUTO_PLAYING&&(t.previousPlaybackState===i.q.AUTO_PLAYING&&t.isLooping?this._setPlayerState(t,i.q.AUTO_PLAYING):this._setPlayerState(t,i.q.USER_PLAYING)),this._stopAllExcept(t)}_handlePause(t){t.playbackState!==i.q.AUTO_PAUSED&&this._setPlayerState(t,i.q.USER_PAUSED)}_handlePlaybackFinished(t,e=!1){this._setPlayerState(t,i.q.FINISHED),t.autoplayGroupEmitter&&t.autoplayGroupEmitter.signalPlaybackComplete(e)}_handlePlaybackPriorityChange(t,e,a){t.playbackPriority=e,t.canAutoplay=a&&e!==i.W.INELIGIBLE,this._scheduleUpdate()}_handleReset(t){this._setPlayerState(t,i.q.INITIAL),this._scheduleUpdate()}_handleUnregister(t){const e=this._players.indexOf(t);e>=0&&this._players.splice(e,1),this._scheduleUpdate()}_triggerAutoplay(){const t=new WeakMap,e=this._players.filter((e=>{const a=this._canAutoPlay(e);return e.autoplayGroupEmitter?a&&this._canGroupAutoplay(e.autoplayGroupEmitter,t):a})),a=this._findBestAutoplayFit(e);if(a){const{autoplayGroupEmitter:t}=a;if(t){const e=t.signalGroupAutoplayRequest();e&&(this._stopAllExcept(e),this._autoPlayVideo(e))}else this._stopAllExcept(a),this._autoPlayVideo(a)}else this._players.forEach((t=>{t.playbackState===i.q.AUTO_PLAYING&&this._pausePlayer(t)}))}_canGroupAutoplay(t,e){if(e.has(t))return e.get(t);const a=t.isAutoplayGroupEligibleForAutoplay();return e.set(t,a),a}_canAutoPlay(t){const e=!!t.placement&&t.placement.visibleFraction()>=this._minimumVisibilityForAutoplay,a=t.playbackState===i.q.USER_PAUSED,n=t.playbackState===i.q.FINISHED;return t.canAutoplay&&e&&!a&&!n}_canPlay(t){const e=!!t.placement&&t.placement.visibleFraction()>=this._minimumVisibilityForAutoplay,a=!!t.placement&&t.placement.visibleFraction()>0;return t.playbackPriority!==i.W.INELIGIBLE&&(!t.placement||a||e)}_stopAllExcept(t){this._players.forEach((e=>{const a=e.playbackPriority!==i.W.SPACE;e===t||!a||e.playbackState!==i.q.USER_PLAYING&&e.playbackState!==i.q.AUTO_PLAYING||this._pausePlayer(e)}))}_pausePlayer(t){const{onPauseRequest:e}=t.commandHandlers;this._setPlayerState(t,i.q.AUTO_PAUSED),e()}_autoPlayVideo(t){const{onAutoPlayRequest:e}=t.commandHandlers;this._setPlayerState(t,i.q.AUTO_PLAYING),e()}_findBestAutoplayFit(t){return this._autoplayPrioritizationPolicy(t)}_getDistanceToCenter(t){return t.placement?t.placement.distanceToCenter():Number.MAX_VALUE}_getDistanceToTop(t){return t.placement?t.placement.distanceToTop():Number.MAX_VALUE}}const u=new c},50744:(t,e,a)=>{a.r(e),a.d(e,{__DANGEROUS_IMPORT_VIDEOPLAYER_BASE__:()=>E,__DANGEROUS_IMPORT__:()=>g});a(6886);var n=a(2784),i=a(25686),l=a(6556),o=a(38250),r=a(73186),s=a(20537),c=a(69058),u=a(99959),p=a(92462),y=a(20032),d=a(92160);const _=()=>(t,e,{api:a})=>a.getHttpClient(),h=(0,d.Z)().propsFromActions((()=>({getTwitterAuthedHttpClient:_}))).withAnalytics();var P=a(5996),m=a(75845);function A(t){const{featureSwitches:e}=n.useContext(y.rC),{acquisitionParams:a,broadcastId:i,isLive:o,isLooping:r,media:s,mediaKey:d,onEnded:_,onPlaybackEmitterCreated:h,onPlayerApi:A,onPlayerState:E,requestedTimecode:g,shouldAutoplayMuted:f}=t,[I,C]=n.useState(null),T=n.useRef({playbackCoordinationEmitter:null,previousPlayerState:null}),q=s||i&&d;if(n.useEffect((()=>{null===I&&q&&(0,u.ij)({showControls:!1,source:{}},e).then((t=>C((()=>t))))}),[I,q,e]),n.useEffect((()=>function(){const{playbackCoordinationEmitter:t}=T.current;t&&t.unregister()}),[]),null===I||!q)return null;const v=Boolean(o&&i&&d),L=!v&&f,F=v?l.W.SPACE:l.W.NORMAL;const U=function(t,e){const a={scribeContext:{...t.analytics.contextualScribeNamespace},enableShortFormCompleteLogging:e.isTrue("responsive_web_video_pcomplete_enabled"),periscopeAuthToken:m.w.proxsee.authToken()},n={log:e=>{const{category:a,data:n,namespace:i}=e;null!=i&&i.action&&t.analytics.scribe({...i,data:{...n,_category_:a}})}};return new P.Z(n,{log:()=>{}},t.getTwitterAuthedHttpClient(),a)}(t,e),N={analytics:U,basePlayerClass:I,httpClient:S,onApiReady:function(e){var a;L||e.play(),"function"==typeof A&&A(e);const n=null==s||null==(a=s.video_info)?void 0:a.duration_millis;"number"==typeof n&&"number"==typeof g&&e.scrubToFraction(g/n);const i={onAutoPlayRequest:function(){L&&e.playPreview()},onPauseRequest:function(){t.disablePlaybackCoordination||e.pause()},playbackPriority:F,canAutoplay:Boolean(f),isLooping:Boolean(r)};T.current.playbackCoordinationEmitter=p.Tc.register(i),h&&h(T.current.playbackCoordinationEmitter)},onStateUpdate:function(t,e){"function"==typeof E&&E(t,e),function(t){const e=k(t);t.isPlaying&&e&&e.durationMs===e.currentTimeMs&&"function"==typeof _&&(_(),T.current.playbackCoordinationEmitter&&T.current.playbackCoordinationEmitter.signalPlaybackFinish())}(t),function(t){const{playbackCoordinationEmitter:e,previousPlayerState:a}=T.current,n=null===a,i=null==a?void 0:a.isPlaying,l=t.isPlaying,o=!n&&i&&!l;!n&&i||!l?o&&e&&e.signalPause():e&&e.signalPlay()}(t),T.current.previousPlayerState=t},twitterAuthedHttpClient:t.getTwitterAuthedHttpClient()};if(i&&d){const t={...N,configType:"static",contentId:d,contentType:"broadcast",variants:[],videoId:c.Z.forAudioSpace(i,d,o,a)};return n.createElement(b,{key:i,playerConfig:t})}if(s){const t={...N,configType:"static",contentId:s.id_str,loop:!1,contentType:"media_entity",durationMs:s.video_info.duration_millis,variants:s.video_info.variants.map((({bitrate:t,content_type:e,url:a})=>({type:e,src:a})))};return n.createElement(b,{key:s.id_str,playerConfig:t})}return null}function b({playerConfig:t}){return n.createElement(i.Z,{style:f.displayNone},n.createElement(o.Z,t))}const E=A,g=h(A),k=t=>t&&t.tracks[t.currentTrackId],S=new s.ZP({}),f=r.Z.create((t=>({displayNone:{display:"none"}})))},17323:(t,e,a)=>{a.d(e,{Qr:()=>o,n8:()=>l});var n=a(6556);const i=(t,e)=>{if(0===t.length)return;let a=t[0],n=e(a);for(let i=1;i<t.length;i++){const l=t[i],o=e(l);o<n&&(a=l,n=o)}return a},l=t=>{var e,a;const n=null==t||null==(e=t[0])||null==(a=e.placement)?void 0:a.scrollY();return i(t,0===n?t=>t.placement?t.placement.distanceToTop():Number.MAX_VALUE:t=>t.placement?t.placement.distanceToCenter():Number.MAX_VALUE)},o=t=>{const e=t.filter((t=>t.playbackPriority===n.W.DOCKABLE));return e.length?e[0]:l(t)}},55249:(t,e,a)=>{a.d(e,{Z:()=>n});const n=(t,e)=>{let a=null;const n=()=>{a=null,t()};return()=>(a||(a=e(n)),a)}}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/loader.AudioOnlyVideoPlayer.099b9929.js.map