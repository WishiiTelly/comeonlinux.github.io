"use strict";(self.webpackChunk_twitter_responsive_web=self.webpackChunk_twitter_responsive_web||[]).push([["shared~loader.Typeahead~bundle.Communities~bundle.Delegate~bundle.Ocf~bundle.LoggedOutHome~bundle.Search~bund"],{99322:(e,t,s)=>{s.d(t,{Z:()=>r});s(2784);var i=s(90601);const o=s(73186).Z.create({initial:{alignItems:"stretch",borderWidth:0,borderStyle:"solid",boxSizing:"border-box",display:"flex",flexDirection:"column",margin:0,padding:0,position:"relative",zIndex:0,minHeight:0,minWidth:0}}),r=e=>{const{style:t,...s}=e;return(0,i.Z)("form",{...s,action:"#",style:[o.initial,t]})}},36830:(e,t,s)=>{s.d(t,{Z:()=>w});var i=s(2784),o=s(28316),r=s(25686),n=s(23162),a=s(16587),l=s(79640),d=s(90581),c=s(40159),h=(s(6886),s(5252)),u=s(73186),p=s(79404),m=s.n(p),f=s(37378);const y=m().f2b3fe06,_=u.Z.create((e=>({hidden:{visibility:"hidden"}}))),g=({isLoading:e})=>{const[t,s]=i.useState(!1);return i.useEffect((()=>{let t;return e?t=setTimeout((()=>s(!0)),f.n):s(!1),()=>clearTimeout(t)}),[e]),i.createElement(h.Z,{ariaValueText:t?y:"",indeterminate:t,style:!t&&_.hidden})};class w extends i.Component{constructor(e,t){super(e),this._setFocusedItemRef=e=>{this._shouldScrollToFocusedItem&&e&&((0,c.up)(this._getScrollParent(),e),this._shouldScrollToFocusedItem=!1)},this._resetScroll=()=>{const e=this._getScrollParent();e&&(e.scrollTop=0)},this._getFlattenedItems=(0,a.Z)((e=>(0,l.Z)(e))),this._handleItemClick=(e,t)=>{const{items:s,onItemClick:i}=this.props,o=this._getFlattenedItems(s).indexOf(e);e&&!t&&!this._shouldBlockInteractivity&&i(e,o),this._resetFocus()},this._getResultCount=()=>{const{items:e}=this.props;return this._getFlattenedItems(e).length},this._setFocusIndex=(e,t)=>{const{items:s,onItemFocusChanged:i}=this.props;this._shouldScrollToFocusedItem=t,this.setState({focusIndex:e}),i&&i(this._getFlattenedItems(s)[e])},this._resetFocus=()=>{this._setFocusIndex(this.props.withItemAlwaysSelected?0:-1)},this.focusNext=()=>{const{focusIndex:e}=this.state,t=this._getResultCount();if(0===t)return;const s=e+1>=t?0:e+1;this._setFocusIndex(s,!0)},this.focusPrevious=()=>{const{focusIndex:e}=this.state,t=this._getResultCount();if(0===t)return;const s=e-1<0?t-1:e-1;this._setFocusIndex(s,!0)},this.hasFocusedItem=()=>{const{focusIndex:e}=this.state,t=this._getResultCount();return e>=0&&t>e},this.selectFocusedItem=()=>{const{focusIndex:e}=this.state,{getItemIsDisabled:t,items:s}=this.props;if(this.hasFocusedItem()){const i=this._getFlattenedItems(s)[e],o=!!t&&t(i,i.data);this._handleItemClick(i,o)}},this.state={focusIndex:e.withItemAlwaysSelected?0:-1}}componentDidMount(){this._resetFocus()}componentWillUnmount(){clearTimeout(this._interactivityTimeout)}componentDidUpdate(e){e.items!==this.props.items&&(this._resetFocus(),this._resetScroll(),this._interactivityTimeout&&clearTimeout(this._interactivityTimeout),this._shouldBlockInteractivity=!0,this._interactivityTimeout=setTimeout((()=>{this._shouldBlockInteractivity=!1}),500))}render(){const{domId:e,isLoading:t,items:s,renderCallout:o,renderHeader:n,renderNoResultsState:a,selectedItems:l,style:d}=this.props,c=!(!t&&!s.length);let h=0;const u=!!l;return c?i.createElement(r.Z,{accessibilityMultiSelectable:u,accessibilityRole:"listbox",nativeID:e,style:d},o?o():null,i.createElement(g,{isLoading:!!t}),n?n():null,s.length?s.map(((e,t)=>{const i=!Array.isArray(s[t-1])&&t>0,o=t<s.length-1,r=Array.isArray(e)?this._renderTypeaheadGroup(e,h,i,o):this._renderTypeaheadItem(e,h);return h+=Array.isArray(e)?e.length:1,r})):null):a?a():null}_renderTypeaheadGroup(e,t,s,o){const{withSectionDivider:r}=this.props;return i.createElement(i.Fragment,{key:`typeaheadGroup-${t}`},r&&s?i.createElement(n.Z,{key:`typeaheadDividerTop-${t}`}):null,e.map(((e,s)=>this._renderTypeaheadItem(e,t+s))),r&&o?i.createElement(n.Z,{key:`typeaheadDividerBottom-${t}`}):null)}_renderTypeaheadItem(e,t){const{ariaDescendantId:s,getItemDisabledMessage:o,getItemIsDisabled:r,getUserDisplayNameLabel:n,query:a,renderUserDecoration:l,selectedItems:c,source:h,withUserHoverCard:u}=this.props,{focusIndex:p}=this.state,m=!(!c||!e.id)&&c.indexOf(e.id)>=0,f=!!c,y=p===t,_=r&&r(e,e.data),g=o&&o(e,e.data);return i.createElement(d.ZP,{disabledMessage:g,domId:y?s:void 0,getUserDisplayNameLabel:n,isDisabled:_,isFocused:y,isInMultiSelect:f,isSelected:m,item:e,key:`typeaheadItem-${t}-${e.id||""}`,onClick:this._handleItemClick,onRef:y?this._setFocusedItemRef:void 0,query:a,renderUserDecoration:l,source:h,withUserHoverCard:u})}_getScrollParent(){if(!this._scrollParent){const e=(0,c.rP)(o.findDOMNode(this));this._scrollParent=e===window?null:e}return this._scrollParent}}},70969:(e,t,s)=>{s.d(t,{Z:()=>J});var i=s(7896),o=s(2784),r=s(79640),n=s(35193),a=s(36830),l=s(20032),d=s(76275),c=s(88027),h=s(37378),u=s(52612),p=s(23803),m=(s(36728),s(6886),s(24949)),f=s(11469),y=s(53223),_=s(23335),g=s(6800),w=s(32941),I=s(92160),v=(s(85940),s(15729)),b=s(71768),C=s(69418),x=s(26853),D=s(53392),E=s(51670),T=s(33997);const S="typeaheadV2",R=[],Z=Object.freeze({REQUEST:"rweb/typeaheadV2/FETCH_REQUEST",SUCCESS:"rweb/typeaheadV2/FETCH_SUCCESS",FAILURE:"rweb/typeaheadV2/FETCH_FAILURE"}),F=({q:e,result_type:t,src:s},i)=>{let o=t;return null!=i&&i.communityId?o=`${t}_${i.communityId}`:null!=i&&i.trustedFriendsId&&(o=`${t}_${i.trustedFriendsId}`),`${e}_${o}_${s}`},P={remoteResults:{},cachedIds:[]};const U=e=>e.map((({rounded_score:e,tokens:t,...s})=>{const{topic:i}=s,o=c.El.Topic;return{id:`${o}_${i.replace(" ","_")}`,type:o,tokens:t,rounded_score:e,data:s}})),N=e=>e.map((({rounded_score:e,tokens:t,...s})=>{var i;const o=c.El.Event,r=null==s||null==(i=s.url)?void 0:i.match(C.Wq.id);return{id:(null==r?void 0:r[0])||"",type:o,tokens:t,rounded_score:e,data:s}})),k=(e,t)=>e.typeaheadV2.remoteResults[t],L=(e,t)=>(s,i)=>{const o=k(i(),F(e,t)),r=o&&o.timestamp;return r&&Date.now()-r<=3e5?Promise.resolve():s(H(e,t))},H=(e,t)=>(s,i,{api:o})=>{if(!e||!e.q||""===e.q.trim())return Promise.resolve();const r={queryId:F(e,t)},{communityId:n,trustedFriendsId:a}=t||{},l=e.result_type.split(","),d={actionTypes:Z,context:"FETCH_TYPEAHEAD",meta:r};if(l.includes(c.my.CommunityUsers)&&n){const t=e=>{const{entities:t}=(null==e?void 0:e.invite_action_results)||{};return t?[(0,E.dP)(t)]:void 0};return(0,D._O)(s,{params:{communityId:n,prefix:e.q},request:o.Typeahead.fetchCommunityInviteUsers})(d,t)}if(l.includes(c.my.CommunityMembers)&&n){const t=e=>{const{entities:t}=(null==e?void 0:e.user_community_relationships)||{};return t?[(0,E.dP)(t)]:void 0};return(0,D._O)(s,{params:{communityId:n,prefix:e.q},request:o.Typeahead.fetchCommunityMembers})(d,t)}return l.includes(c.my.TrustedFriendsSuggested)&&a?(0,D._O)(s,{params:{trustedFriendsId:a,prefix:e.q},request:o.Typeahead.fetchTrustedFriendsSuggestions})(d):(0,D._O)(s,{params:e,request:o.Typeahead.fetch})(d)};x.Z.register({[S]:function(e=P,t){switch(t.type){case Z.REQUEST:{const{meta:{queryId:s}}=t;return(0,v.ZP)(e,(e=>{e.remoteResults[s]||(e.remoteResults[s]={fetchStatus:p.ZP.NONE}),e.remoteResults[s].fetchStatus=p.ZP.LOADING}))}case Z.SUCCESS:{const{meta:{queryId:s},payload:i}=t;if(!i)return e;const o=i.users.map((e=>(0,T.gJ)(e,c.vA.Remote))),r={fetchStatus:p.ZP.LOADED,id:s,orderedSections:i.ordered_sections,events:N(i.events),topics:U(i.topics),users:(0,c.It)(o),timestamp:Date.now()};return(0,v.ZP)(e,(e=>{e.cachedIds=e.cachedIds.filter((e=>e!==s)),e.cachedIds.push(s),e.cachedIds.length>=25&&(e.remoteResults=(0,b.Z)(e.remoteResults,e.cachedIds.splice(0,1))),e.remoteResults[s]=r}))}case Z.FAILURE:{const{meta:{queryId:s}}=t;return(0,v.ZP)(e,(e=>{e.remoteResults[s].fetchStatus=p.ZP.FAILED}))}default:return e}}});var A=s(41430),M=s(86928),O=s(57659);const q=[c.my.Users],B=e=>{const{communityId:t,filter:s,query:i,source:o,trustedFriendsId:r}=e;return F({q:i,result_type:(s||q).join(","),src:o},{communityId:t,trustedFriendsId:r})},z=(e,t)=>((e,t)=>{const s=k(e,t);return s&&s.fetchStatus})(e,B(t)),V=(e,t)=>((e,t)=>{const s=k(e,t);return s&&s.users||R})(e,B(t)),W=(e,t)=>((e,t)=>{const s=k(e,t);return s&&s.topics||R})(e,B(t)),$=(e,t)=>((e,t)=>{const s=k(e,t);return s&&s.events||R})(e,B(t)),j=(e,t)=>(t.rounded_graph_weight||0)-(e.rounded_graph_weight||0),Q=()=>(0,m.P1)(V,(0,m.P1)(((e,t)=>t.query),((e,t)=>t.filter),A.Sc,A.sM,((e,t,s,i)=>{if(!e||!t||t.indexOf(c.my.Users)<0)return(0,g.o)();const o=(0,A.UA)(s,e);return(0,c.It)(o.map((e=>i[e])).sort(j).slice(0,10))})),z,((e,t)=>t.injectedItems),((e,t)=>t.query),((e,t)=>t.getUserExactMatch),((e,t)=>t.userLimit),((e,t,s,i,o,r,n)=>{const a=(0,f.Z)(i||[],(e=>e.type===c.El.User?e.data.id_str:void 0)),l=t.filter((e=>a.indexOf(e.id)<0)),d=e.filter((e=>a.indexOf(e.id)<0)),h=(0,w.sY)(l,d).slice(0,n||10),u=s===p.ZP.LOADED,m=r&&r({query:o,hasResults:!!e.length,isLoaded:u}),y=m?[...h,m]:h;return{users:y.length?y:(0,g.o)(),userExactMatch:m,filteredPrefetchUsers:l,filteredRemoteUsers:d}})),G=()=>(0,m.P1)(Q(),(0,m.P1)(W,z,((e,t)=>t.query),((e,t)=>t.maxTopics),((e,t)=>t.getTopicExactMatch),((e,t,s,i,o)=>{const r=t===p.ZP.LOADED,n=o&&o({query:s,hasResults:!!e.length,isLoaded:r}),a=e.slice(0,i||3);return n&&a.push(n),a.length?a:(0,g.o)()})),(0,m.P1)($,z,((e,t)=>t.query),((e,t)=>t.maxEvents),((e,t)=>t.filter),((e,t,s,i,o)=>{const r=s&&o&&o.indexOf(c.my.Events)>=0,n=e.slice(0,i||1);return n.length&&r?n:(0,g.o)()})),((e,t)=>t.injectedItems),((e,t)=>t.orderResults),((e,t,s,i,o)=>{const{users:r}=e,n=i&&i.length?i:null,a=o?o(n,r,t,s,null==e?void 0:e.filteredRemoteUsers,null==e?void 0:e.filteredPrefetchUsers,null==e?void 0:e.userExactMatch):(0,y.Z)([n,s.length?s:void 0,t.length?t:void 0,r.length?r:void 0]);return t.length||r.length||s.length?a:n?[n]:(0,g.o)()})),Y=(0,I.Z)().propsFromState((()=>({fetchStatus:z,items:G()}))).propsFromActions((()=>({createLocalApiErrorHandler:(0,_.createLocalApiErrorHandlerWithContextFactory)("TYPEAHEAD_DROPDOWN_CONTAINER_CONTEXT"),fetchTypeaheadIfNeeded:L,fetchUsersIfNeeded:O.ZP.fetchManyIfNeeded,fetchUsersPresenceIfNeeded:M.ZP.fetchManyIfNeeded,prefetchTypeaheadUsersIfNeeded:A.zP}))).withAnalytics({element:"typeahead"});class K extends o.Component{constructor(e,t){super(e,t),this._fetchUsersIfNeeded=(e=[])=>{const{fetchUsersIfNeeded:t,items:s,source:i}=this.props;if(this.context.featureSwitches.isTrue("follow_nudge_search_enabled")&&this.context.loggedInUserId&&i===c._4.SearchBox){const i=(0,r.Z)(e).filter((e=>e.type===u.ZP.User)).map((e=>e.id)),o=(0,r.Z)(s).filter((e=>e.type===u.ZP.User)).filter((e=>!i.includes(e.id))).map((e=>e.id));(null==o?void 0:o.length)&&t(o)}},this._fetchTypeaheadResultsIfNeeded=e=>{const t=this.context.featureSwitches.isTrue("c9s_community_composer_hashtag_suggestions_enabled");e.query&&e.fetchTypeaheadIfNeeded({q:e.query,src:e.source,result_type:e.filter.join(","),context_text:e.contextText,topic_type:e.topicType,context_community_id:t?e.communityId:void 0},{communityId:e.communityId,trustedFriendsId:e.trustedFriendsId}).catch(e.createLocalApiErrorHandler({}))},this._handleItemClick=(e,t)=>{const{analytics:s,onItemClick:i,query:o}=this.props;i(e,t);const r=d.Z.forTypeaheadResult(e,t),n=r?[r]:void 0;s.scribe({action:"click",data:{search_details:{query:o},targets:n}})},this._scribeResults=()=>{const{analytics:e,items:t,query:s}=this.props;e.scribe({action:"impression",data:{items:d.Z.forTypeaheadResults(t),search_details:{query:s}}})},this._debouncedFetchTypeaheadResultsIfNeeded=(0,n.Z)(this._fetchTypeaheadResultsIfNeeded,250),this.state={shouldShowPrefetchResults:!0}}componentDidMount(){const{createLocalApiErrorHandler:e,prefetchTypeaheadUsersIfNeeded:t}=this.props;this._debouncedFetchTypeaheadResultsIfNeeded(this.props),t().catch(e({})),this._fetchUsersIfNeeded()}componentWillUnmount(){clearTimeout(this._prefetchResultsTimer)}componentDidUpdate(e){const{createLocalApiErrorHandler:t,domId:s,fetchUsersPresenceIfNeeded:i,filter:o,items:n,onItemsChanged:a,query:l,shouldDeferPrefetch:d,source:c}=this.props,{filter:m,query:f,source:y}=e,{loggedInUserId:_}=this.context,g=this.context.featureSwitches.isTrue("voice_rooms_typeahead_audiospace_ring_enabled")&&_;if(null!=n&&n.length&&n!==e.items){if(this._scribeResults(),a){let e=!1;const t=s?document.getElementById(s):null;t&&t.scrollHeight>t.offsetHeight&&(e=!0),a(n,e)}if(g){const e=(0,r.Z)(n).filter((e=>e.type===u.ZP.User)).map((e=>e.id));e&&i(e).catch(t({}))}this._fetchUsersIfNeeded(e.items)}l===f&&o===m&&c===y||(this._debouncedFetchTypeaheadResultsIfNeeded(this.props),d&&(clearTimeout(this._prefetchResultsTimer),this.setState({shouldShowPrefetchResults:!1}),this._prefetchResultsTimer=setTimeout((()=>{this.props.query&&this.props.fetchStatus!==p.ZP.LOADED&&this.setState({shouldShowPrefetchResults:!0})}),h.n)))}render(){const{analytics:e,communityId:t,contextText:s,createLocalApiErrorHandler:r,dropdownRef:n,fetchStatus:l,fetchTypeaheadIfNeeded:d,fetchUsersIfNeeded:c,fetchUsersPresenceIfNeeded:h,filter:u,getTopicExactMatch:m,getUserExactMatch:f,injectedItems:y,items:_,maxEvents:g,maxTopics:w,onItemClick:I,onItemsChanged:v,orderResults:b,prefetchTypeaheadUsersIfNeeded:C,query:x,shouldDeferPrefetch:D,topicType:E,trustedFriendsId:T,userLimit:S,...R}=this.props,Z=x&&l!==p.ZP.LOADED,F=Z&&!this.state.shouldShowPrefetchResults?y:_;return o.createElement(a.Z,(0,i.Z)({},R,{isLoading:!!Z,items:F,onItemClick:this._handleItemClick,query:x,ref:n}))}}K.contextType=l.rC,K.defaultProps={filter:[c.my.Users],injectedItems:[],maxEvents:3,maxTopics:1};const X=o.forwardRef(((e,t)=>o.createElement(K,(0,i.Z)({},e,{dropdownRef:t})))),J=Y.forwardRef(X)},74383:(e,t,s)=>{s.r(t),s.d(t,{TypeaheadInput:()=>S,default:()=>Z,styles:()=>R});var i=s(2784),o=s(25686),r=s(73186),n=s(35030),a=s(22150),l=s(86242),d=s(54044),c=s(79404),h=s.n(c),u=s(54170),p=s(99322),m=s(70969),f=s(27036),y=s(95254),_=s(52008),g=s(77559),w=s(12599),I=s(79075),v=s(88027),b=s(32941),C=s(20032);const x=h().f065ba8c,D={viewType:"typeahead_input"},E=e=>_.Z.isTwoColumnNormalLayout(e)?{width:f.Z.columnWidths.secondary.normal+r.Z.theme.spacesPx.space24,left:-r.Z.theme.spacesPx.space24/2}:_.Z.isTwoColumnSmallLayout(e)?{width:f.Z.columnWidths.secondary.small+r.Z.theme.spacesPx.space16,left:-r.Z.theme.spacesPx.space16/2}:void 0;let T=1;class S extends i.Component{constructor(e,t){super(e,t),this._withNewTypeaheadUI=!1,this._render=({containerWidth:e})=>{const{alwaysOpen:t,disableClearButton:s,forceVdlDisable:r,inputStyle:l,isCompact:d,isOnHomepage:c,placeholder:h,renderInSearchField:m,rounded:f,shouldAutoFocus:y,shouldFocusOnClear:_,style:g,testID:I}=this.props,v=this.state.showTypeaheadDropdown||t;return i.createElement(w.Z,{behavioralEventContext:D},i.createElement(o.Z,{onLayout:this._handleLayout,ref:this._setRootContainerNode,style:[R.root,g]},i.createElement(n.Z,{onKeyDown:this._handleKeyDown,style:R.keydownInputListener},i.createElement(p.Z,{accessibilityLabel:h,accessibilityRole:"search",onSubmit:this._handleFormSubmit,style:R.wrapper},i.createElement(o.Z,{ref:this._setInputContainerNode,style:l},i.createElement(a.Z,{Icon:u.Z,ariaActiveDescendant:this.state.ariaDescendantId,ariaAutocomplete:"list",ariaExpanded:v,ariaLabel:x,ariaOwns:this._dropdownDomId,ariaRole:"combobox",autoComplete:"off",autoCorrect:!1,autoFocus:y,contentBelow:m&&m(),focusOnClear:_,isCompact:d,leftAligned:c,onBlur:this._handleInputBlur,onChange:this._handleInputChange,onClear:this._handleInputClear,onFocus:this._handleInputFocus,onLayout:this._handleInputLayoutChanged,placeholder:h,ref:this._setInputRef,returnKeyType:"search",spellCheck:"false",styleType:r?"legacyPill":f?"pill":"selection",testID:I,value:this.state.query,withClearButton:!s&&this.state.showTypeaheadDropdown})),i.createElement(o.Z,{style:[R.typeaheadContainer,!f&&R.topBorder]},v?this._renderDropdown(e):null)))))},this._renderDropdown=e=>{const{communityId:t,filter:s,getItemDisabledMessage:o,getItemIsDisabled:n,getTopicExactMatch:a,getUserDisplayNameLabel:l,getUserExactMatch:d,injectedItems:c,isInSidebar:h,isModal:u,isOnHomepage:p,maxEvents:f,maxTopics:y,onItemsChanged:_,orderResults:w,renderCallout:I,renderEmptyState:v,renderHeader:C,renderNoResultsState:x,renderUserDecoration:D,selectedItems:T,shouldDeferPrefetch:S,source:Z,trustedFriendsId:F,withFixedPositioning:P,withSectionDivider:U,withUserHoverCard:N}=this.props,k=e>=r.Z.theme.breakpoints.medium||(0,g.ZP)(),{dropdownOffset:L,query:H}=this.state,A=u?R.modalDropdown:[R.dropdown,!k&&P&&L?[(0,b.xX)(L),{height:`calc(100vh - ${L}px)`}]:null,(k||p)&&R.wideModeDropdown,this._withNewTypeaheadUI&&h&&E(e),p&&R.shortModeDropdown,!k&&p&&R.shortModeDropdownMobile],M={ariaDescendantId:this.state.ariaDescendantId,domId:this._dropdownDomId,onDismiss:this._handleOnEmptyStateDismiss,onItemFocusChanged:this._handleItemFocusChanged,ref:this._handleDropdownRef,style:A};return v&&!H?v(M):i.createElement(m.Z,{ariaDescendantId:this.state.ariaDescendantId,communityId:t,domId:this._dropdownDomId,filter:s,getItemDisabledMessage:o,getItemIsDisabled:n,getTopicExactMatch:a,getUserDisplayNameLabel:l,getUserExactMatch:d,injectedItems:c,maxEvents:f,maxTopics:y,onItemClick:this._handleItemClick,onItemFocusChanged:this._handleItemFocusChanged,onItemsChanged:_,orderResults:w,query:H,ref:this._handleDropdownRef,renderCallout:I,renderHeader:C,renderNoResultsState:x,renderUserDecoration:D,selectedItems:T,shouldDeferPrefetch:S,source:Z,style:A,trustedFriendsId:F,withSectionDivider:U,withUserHoverCard:N})},this._dismissDropdown=()=>{this.setState({showTypeaheadDropdown:!1}),this.props.onDismiss&&this.props.onDismiss()},this._handleOnEmptyStateDismiss=()=>{this._dismissDropdown(),this._inputRef&&this._inputRef.blur()},this._handleLayout=()=>{this._updatePosition()},this._handleInputLayoutChanged=()=>{this._updatePosition()},this._updatePosition=()=>{if(!this._inputContainerNode)return;const{bottom:e}=this._inputContainerNode.getBoundingClientRect();e!==this.state.dropdownOffset&&this.setState({dropdownOffset:e})},this._handleDropdownRef=e=>{this._dropdownRef=e},this._setRootContainerNode=e=>{this._rootContainerNode=e||null},this._setInputRef=e=>{this._inputRef=e,this._activeChildRef||(this._activeChildRef=e)},this._setInputContainerNode=e=>{this._inputContainerNode=e||null,this._inputContainerNode&&this._updatePosition()},this._handleFocusChange=e=>{const t=l.Z.getCount()>0;this._rootContainerNode&&this._rootContainerNode.contains(e.target)||t||this.state.showTypeaheadDropdown&&this._dismissDropdown()},this._handleKeyDown=e=>{const{key:t,shiftKey:s}=e,{alwaysOpen:i}=this.props,{showTypeaheadDropdown:o}=this.state;if((0,b.kE)(e))if(t!==I.Dd){if(this.state.inputHasFocus)return t===I.WX?(this._focusNext(),void e.preventDefault()):t===I.kl?(this._focusPrevious(),void e.preventDefault()):t===I.nQ&&!i&&o?(this._dismissDropdown(),void e.preventDefault()):t===I.NW&&this._hasFocusedItem()?(this._selectFocusedItem(),void e.preventDefault()):void(t!==I.jF&&t!==I.Ci||!this._deleteFocusedItem()?o||this.setState({showTypeaheadDropdown:!0}):e.preventDefault())}else{const t=s&&this._navigatePrevious()||!s&&this._navigateNext();t?(this._activeChildRef=t,e.preventDefault(),t.focus()):this._dismissDropdown()}},this._handleItemFocusChanged=()=>{this.setState({ariaDescendantId:(0,b.A1)()})},this._handleInputClear=()=>{this.setQuery("")},this._handleInputBlur=()=>{this.setState({inputHasFocus:!1}),this.props.onBlur&&this.props.onBlur()},this._handleInputFocus=()=>{this._activeChildRef=this._inputRef,this.setState({inputHasFocus:!0,showTypeaheadDropdown:!0}),this._updatePosition(),this.props.onFocus&&this.props.onFocus()},this._handleInputChange=e=>{this.setQuery(e.target.value),this._updatePosition()},this._handleFormSubmit=e=>{e.preventDefault(),e.stopPropagation(),this._inputRef&&this._inputRef.blur(),this.setState({showTypeaheadDropdown:!1}),this.props.onDismiss&&this.props.onDismiss(),this.props.onSubmit&&this.props.onSubmit()},this._handleItemClick=(e,t)=>{const{onDismiss:s,onItemClick:i,shouldClearOnSelect:o,shouldFocusOnClear:r}=this.props,n=o?"":this.state.query;this.setState({showTypeaheadDropdown:!1}),this._inputRef&&(o&&r?this._inputRef.focus():this._inputRef.blur()),this.setQuery(n),s&&s(),i&&i(e,t)},this._hasFocusedItem=()=>this._dropdownRef&&this._dropdownRef.hasFocusedItem(),this._deleteFocusedItem=()=>!!(this._dropdownRef&&this._dropdownRef.deleteFocusedItem&&this._dropdownRef.hasFocusedItem()&&this._dropdownRef.deleteFocusedItem()),this._selectFocusedItem=()=>{this._dropdownRef&&this._dropdownRef.selectFocusedItem()},this._focusNext=()=>{this._dropdownRef&&this._dropdownRef.focusNext()},this._focusPrevious=()=>{this._dropdownRef&&this._dropdownRef.focusPrevious()},this._navigateNext=()=>{if(this._dropdownRef&&this._dropdownRef.navigateNext)return this._dropdownRef.navigateNext()},this._navigatePrevious=()=>{if(!this.state.inputHasFocus&&this._dropdownRef&&this._dropdownRef.navigatePrevious)return this._dropdownRef.navigatePrevious()||this._inputRef},this.state={ariaDescendantId:(0,b.A1)(),inputHasFocus:!1,query:e.initialValue,showTypeaheadDropdown:!1},this._dropdownDomId=`typeaheadDropdown-${T}`,T+=1,this._withNewTypeaheadUI=this.context.featureSwitches.isTrue("responsive_web_account_search_readability_enabled")}componentDidUpdate(e){this.props.initialValue!==e.initialValue&&this.setQuery(this.props.initialValue)}componentDidMount(){window.document.addEventListener("click",this._handleFocusChange,!0)}componentWillUnmount(){window.document.removeEventListener("click",this._handleFocusChange,!0)}render(){return i.createElement(d.Z,null,this._render)}focus(){this._activeChildRef&&this._activeChildRef.focus()}setQuery(e){this.setState({query:e}),this.props.onQueryChange&&this.props.onQueryChange(e)}}S.defaultProps={disableClearButton:!1,filter:[v.my.Users,v.my.Topics],isInSidebar:!1,initialValue:"",withSectionDivider:!0,withUserHoverCard:!1},S.contextType=C.rC;const R=r.Z.create((e=>({root:{flex:1,flexDirection:"column",position:"relative",zIndex:y.R0+1},typeaheadContainer:{flex:1,position:"relative"},keydownInputListener:{flexShrink:1},dropdown:{backgroundColor:e.colors.cellBackground,start:0,end:0,overflowY:"auto",overscrollBehavior:"contain",position:"absolute",top:0,WebkitOverflowScrolling:"touch"},modalDropdown:{backgroundColor:e.colors.cellBackground,flex:1,minHeight:300,position:"relative",overflowY:"auto",overscrollBehavior:"auto",WebkitOverflowScrolling:"touch"},wideModeDropdown:{borderRadius:e.borderRadii.medium,boxShadow:e.boxShadows.medium,minHeight:100,maxHeight:`calc(80vh - ${e.componentDimensions.appBarHeight})`},shortModeDropdown:{minHeight:100,maxHeight:"35vh",paddingBottom:"0"},shortModeDropdownMobile:{position:"absolute",height:"40vh",top:0},wrapper:{alignItems:"stretch",flex:1},topBorder:{borderTopColor:e.colors.gray200,borderTopStyle:"solid",borderTopWidth:e.borderWidths.small}}))),Z=S},86045:(e,t,s)=>{s.d(t,{Z:()=>d});var i=s(2784),o=s(25686),r=s(35953),n=s(44329),a=s(36934);const l=s(73186).Z.create((e=>({root:{flexDirection:"row",flexShrink:1,flexGrow:1},bodyColumn:{justifyContent:"center",flexDirection:"column",marginEnd:e.spaces.space4,marginStart:e.spaces.space12,flexShrink:1},coverContainer:{borderRadius:e.borderRadii.large,overflow:"hidden"},cellThumbnail:{height:e.spaces.space48,width:e.spaces.space48},largeCellThumbnail:{height:e.spaces.space56,width:e.spaces.space56}}))),d=function(e){const{image:t,style:s,supportText:d,title:c,withNewTypeaheadUI:h}=e;return i.createElement(o.Z,{style:[l.root,s]},i.createElement(o.Z,{style:[l.coverContainer,h?l.largeCellThumbnail:l.cellThumbnail]},t?i.createElement(r.Z,{accessibilityLabel:"",aspectMode:n.Z.SQUARE,image:t}):null),i.createElement(o.Z,{style:l.bodyColumn},d?i.createElement(a.ZP,{color:"gray700",numberOfLines:1,size:"subtext2"},d):null,i.createElement(a.ZP,{numberOfLines:2,weight:"bold"},c)))}},90581:(e,t,s)=>{s.d(t,{ib:()=>le,ZP:()=>re});var i=s(2784),o=s(25686),r=s(74062),n=s(36934),a=s(73186),l=s(33363),d=s(7066),c=s(12599),h=s(88027),u=s(20032),p=s(37541),m=s(67313),f=s(44016),y=s(84515),_=s(92160),g=s(92157),w=s(57659);const I=(e,t)=>t.conversationId,v=(e,t)=>(0,g.x)(e,I(0,t)),b=(0,_.Z)().propsFromState((()=>({conversationId:I,conversation:v,users:w.ZP.selectAll}))).adjustStateProps((({conversation:e,conversationId:t,users:s})=>{const i={conversation:void 0};return null!=e&&e.data&&(i.conversation=(0,y.E5)(e.data,void 0,s)),i})),C=a.Z.create((e=>({root:{cursor:"pointer",paddingHorizontal:e.componentDimensions.gutterHorizontal,paddingVertical:e.componentDimensions.gutterVertical,width:"100%"},avatarColumn:{flexGrow:1,maxWidth:e.spaces.space40,minWidth:"32px"},bodyColumn:{flexGrow:7,alignItems:"center",flexDirection:"row",justifyContent:"space-between"},disabled:{opacity:.6,backgroundColor:e.colors.gray0}}))),x=b((({conversation:e,isDisabled:t,isSelected:s,perspective:o})=>e?i.createElement(p.Z,{avatarCell:i.createElement(m.Z,{conversation:e,perspective:o,size:"xLarge"}),avatarCellStyle:C.avatarColumn,avatarSize:"xLarge",cellStyle:C.bodyColumn,style:[C.root,!s&&t&&C.disabled]},i.createElement(f.Z,{conversation:e,perspective:o,withParticipantsCount:!0}),le({isSelected:s})):null));var D=s(59890),E=s(12934),T=s(35953),S=s(44329);class R extends i.PureComponent{render(){const{event:e,image:t,supportText:s}=this.props;return i.createElement(o.Z,{style:F.root},i.createElement(D.Z,{withGutter:!0},i.createElement(o.Z,{style:F.bodyColumn},s?i.createElement(n.ZP,{color:"gray700",size:"subtext2"},s):null,i.createElement(n.ZP,{numberOfLines:1},e)),t?i.createElement(o.Z,{style:F.coverContainer},i.createElement(E.Z,{ratio:1},i.createElement(T.Z,{accessibilityLabel:"",aspectMode:S.Z.SQUARE,image:t}))):null))}}const Z="100px",F=a.Z.create((e=>({root:{paddingHorizontal:e.componentDimensions.gutterHorizontal,paddingVertical:e.spaces.space16},bodyColumn:{flexGrow:7,justifyContent:"center"},coverContainer:{backgroundColor:e.colors.gray200,borderRadius:e.borderRadii.small,flexGrow:1,justifyContent:"flex-end",maxHeight:Z,maxWidth:Z,overflow:"hidden",width:"25%"}}))),P=R;var U=s(86045),N=s(69165),k=s(38749),L=s(80166),H=s(10891),A=(s(53985),s(36728),s(85940),s(35903)),M=s.n(A);const O=a.Z.create((e=>({root:{paddingHorizontal:e.componentDimensions.gutterHorizontal,paddingVertical:e.spaces.space16},context:{alignItems:"center",flexDirection:"row"},icon:{color:e.colors.primary,height:e.fontSizes.subtext2,paddingEnd:e.spaces.space4,width:e.fontSizes.subtext2},disabled:{backgroundColor:e.colors.gray0},searchIcon:{marginEnd:e.spaces.space12,borderWidth:0,backgroundColor:"none"},searchIconCell:{flexDirection:"row",alignItems:"center"},wrapperCellStyle:{justifyContent:"center"}}))),q=function(e){const{featureSwitches:t}=i.useContext(u.rC),{isDisabled:s,query:r,resultContext:a,showIcon:l,style:d,topic:c,withNewTypeaheadUI:h}=e,m=function(e,t,s=!1){const i=M()(e),o=e.toLowerCase().indexOf(t.toLowerCase()),r=o+t.length;let n;if(0===i.length){const t=s?[o>0?[0,o]:void 0,[r,e.length]].filter(Boolean):[[o,r]];n=[{highlights:-1!==o?t:void 0,text:e,entityType:"text",prefix:""}]}else{const t=i.flatMap((({indices:t},s,i)=>{const o=0===s?0:i[s-1].indices[1],r=s===i.length-1,n=[];return o!==t[0]&&n.push(e.slice(o,t[0])),n.push(e.substring(t[0],t[1])),r&&e.length!==t[1]&&n.push(e.slice(t[1])),n}));let a=0;const l=t.map(((e,t,s)=>{a+=t>0?s[t-1].length:0;const i=e.length;return{runningTotal:a,containsQuery:-1!==o&&a+i>=o&&a<r}}));n=t.map(((e,t)=>{var i;const{containsQuery:n,runningTotal:a}=l[t],d=e.includes("#");let c;if(s&&!n)c=[[0,e.length]];else if(n){const t=a<o?o-a:0,i=a+e.length<r?e.length:r-a,n=d?t-1:t,l=d?i-1:i;c=s?[n>0?[0,n]:void 0,l!==e.length-1?[l,e.length]:void 0].filter(Boolean):[[n,l]]}const h=d?`${null==e?void 0:e.replace("#","")}`:e;return{highlights:null!=(i=c)&&i.length?c:void 0,text:h,entityType:d?"hashtag":"text",prefix:d?"#":""}}))}return n}(c,t.isTrue("responsive_web_typeahead_reverse_bolding_enabled")?r:"",true),f=i.createElement(n.ZP,null,m.map(((e,t)=>i.createElement(N.ZP,{key:`${e.text}${t}`,part:e})))),y=h?"xxxLarge":"xLarge",_=i.createElement(i.Fragment,null,f,a?i.createElement(o.Z,{style:O.context},a&&a.types[0]&&"followable_topic"===a.types[0].type?i.createElement(L.Z,{style:O.icon}):null,i.createElement(n.ZP,{color:"gray700"},a.display_string||" ")):null);return i.createElement(o.Z,{style:[O.root,s&&O.disabled,d]},l?(e=>{const t=i.createElement(k.Z,{Icon:H.Z,color:"neutral",size:y,style:O.searchIcon});return i.createElement(p.Z,{avatarCell:t,avatarCellStyle:O.searchIconCell,avatarSize:y,cellStyle:O.wrapperCellStyle},e)})(_):_)};s(6886);var B=s(19153),z=s(79404),V=s.n(z),W=s(35210),$=s(86928);const j=(e,t)=>(0,$.cY)(e,t.userId),Q=(0,_.Z)().propsFromState((()=>({userSpace:j}))),G="TypeaheadUser",Y=V().ae2205d2,K=V().d960b55c,X=V().fd06b02f,J=Object.freeze({num_of_followers:W.Z.Follow,bio:W.Z.TextOnly,location:W.Z.Location,num_tweets:W.Z.NewTweets,follow_relationship:W.Z.Follow,followers_follow:W.Z.Follow,social_proof:W.Z.SocialProof,follow_relationship_mutual_follow:W.Z.FollowMutual,follow_relationship_followed:W.Z.FollowFollowed,follow_relationship_following:W.Z.FollowFollowing});class ee extends i.PureComponent{constructor(...e){super(...e),this._handleAvatarClick=()=>{const{userSpace:e}=this.props;e||this._handleClick()},this._handleClick=()=>{const{isDisabled:e,item:t,onItemClick:s}=this.props;s&&s(t,!!e)}}render(){const{avatarUri:e,decoration:t,disabledMessage:s,displayNameLabel:o,isBlueVerified:r,isDisabled:n,isProtected:a,isVerified:l,name:d,screenName:c,source:u,userId:p,userSpace:m,withHoverCard:f,withNewTypeaheadUI:y}=this.props,{featureSwitches:_}=this.context,g=this._getSocialContext(),w=this._getResultContext()||g,I=u===h._4.SearchBox,v=_.isTrue("responsive_web_twitter_blue_verified_badge_is_enabled"),b=m&&_.isTrue("voice_rooms_typeahead_audiospace_ring_enabled")?m:void 0;return b&&(b.accessibilityLabel=X({screenName:c})),i.createElement(B.ZP,{avatarSize:"xLarge",avatarUri:e,decoration:t,disabledMessage:n?s:void 0,displayMode:y?"ExperimentalUserTypeahead":"UserCompact",displayNameLabel:o,isBlueVerified:v&&r,isDisabled:n,isProtected:a,isVerified:l,name:d,onAvatarClick:this._handleAvatarClick,onCellClick:this._handleClick,onScreenNameClick:this._handleClick,presenceIndicator:I?b:void 0,screenName:c,socialContext:w,testID:G,userId:p,withInteractiveStyling:!1,withLink:f})}_getSocialContext(){const{socialContext:e}=this.props;if(!e||!e.following)return;const t=e.followed_by?Y:K;return{contextType:W.Z.Follow,text:t}}_getResultContext(){const{resultContext:e,source:t,withNewTypeaheadUI:s}=this.props;if(!(s&&e&&e.display_string&&e.types&&t===h._4.SearchBox))return;return{contextType:(e.types.length?J[e.types[0].type]:void 0)||W.Z.TextOnly,text:e.display_string}}}ee.contextType=u.rC,ee.defaultProps={withNewTypeaheadUI:!1,withHoverCard:!1};const te=Q.forwardRef(ee),se="typeaheadResult",ie={viewType:"typeahead_result"},oe=({children:e})=>e;function re(e){return i.createElement(oe,{item:e.item},i.createElement(ne,e))}class ne extends i.Component{constructor(e,t){super(e,t),this._onViewRef=e=>{this._viewRef=e;const{onRef:t}=this.props;t&&t(e)},this._handleClick=()=>{const{item:e}=this.props;e.type!==h.El.User&&this.props.onClick&&this.props.onClick(e,this.isDisabled)},this._withNewTypeaheadUI=this.context.featureSwitches.isTrue("responsive_web_account_search_readability_enabled")&&e.source===h._4.SearchBox}componentDidMount(){this._loaded=!0,this._viewRef&&(this._rafId=window.requestAnimationFrame((()=>{this._viewRef&&this._viewRef.setNativeProps({style:{opacity:1}})})))}componentDidUpdate(e){const{onRef:t}=this.props;t&&t!==e.onRef&&this._viewRef&&t(this._viewRef)}componentWillUnmount(){this._rafId&&window.cancelAnimationFrame(this._rafId)}render(){const{domId:e,isDisabled:t,isFocused:s,isInMultiSelect:n,isSelected:a,style:l}=this.props;return i.createElement(c.Z,{behavioralEventContext:ie},i.createElement(o.Z,{accessibilityChecked:!(!n||!a)||void 0,accessibilityRole:"option",accessibilitySelected:t?void 0:n&&a||!n&&!!s,nativeID:e,testID:se},i.createElement(r.Z,{accessibilityRole:n?"checkbox":"button",disabled:t,focusable:!0,onPress:this._handleClick,style:[s&&ae.focused,ae.transitionStyles,this._loaded&&ae.loaded,l],viewRef:this._onViewRef},this._renderResult())))}_renderResult(){const{disabledMessage:e,getUserDisplayNameLabel:t,isDisabled:s,isSelected:r,item:a,onClick:d,renderUserDecoration:c,source:u,withUserHoverCard:p}=this.props,m=this.context.featureSwitches.isTrue("responsive_web_twitter_blue_verified_badge_is_enabled");switch(a.type){case h.El.User:{const{data:o}=a,n=c?c({userId:o.id_str,user:o,isSelected:r}):void 0,l=t?t(a,o):void 0;return i.createElement(te,{avatarUri:o.profile_image_url_https,canDm:!!o.can_dm,canMediaTag:!!o.can_media_tag,decoration:n||void 0,disabledMessage:e,displayNameLabel:l,isBlueVerified:m&&!!o.is_blue_verified,isDisabled:s,isProtected:!!o.protected,isVerified:!!o.verified,item:a,name:o.name,onItemClick:d,resultContext:o.result_context,screenName:o.screen_name,socialContext:o.social_context,source:u,userId:o.id_str,withHoverCard:p,withNewTypeaheadUI:this._withNewTypeaheadUI})}case h.El.Event:{const{data:e}=a;return this._withNewTypeaheadUI?i.createElement(U.Z,{image:e.primary_image&&e.primary_image.original_info,style:ae.itemPadding,supportText:e.supporting_text,title:e.topic,withNewTypeaheadUI:!0}):i.createElement(P,{event:e.topic,image:e.primary_image&&e.primary_image.original_info,supportText:e.supporting_text})}case h.El.Hashtag:case h.El.Topic:{const{query:e}=this.props,{data:t}=a,o=u===h._4.SearchBox;return i.createElement(q,{isDisabled:s,query:e||"",resultContext:t.result_context,showIcon:o,style:o?ae.itemPadding:void 0,topic:t.topic,withNewTypeaheadUI:this._withNewTypeaheadUI})}case h.El.DMConversation:return!!this.context.loggedInUserId&&i.createElement(x,{conversationId:a.id,isDisabled:s,isSelected:r,perspective:this.context.loggedInUserId});case h.El.SettingGroup:{const{text:e}=a.data;return i.createElement(o.Z,{style:ae.navigationLink},i.createElement(n.ZP,{style:ae.content,weight:"bold"},e),i.createElement(l.Z,{style:ae.icon}))}case h.El.Setting:{const{text:e}=a.data;return i.createElement(o.Z,{style:ae.navigationLink},i.createElement(n.ZP,{style:ae.content},e),i.createElement(l.Z,{style:ae.icon}))}case h.El.NoResult:{const{data:e}=a,{text:t}=e;return i.createElement(n.ZP,{style:ae.noResult},t)}default:return null}}get isDisabled(){return!!this.props.isDisabled}}ne.contextType=u.rC;const ae=a.Z.create((e=>({checkIcon:{color:e.colors.primary},navigationLink:{alignItems:"center",flexDirection:"row",flexGrow:1,paddingHorizontal:e.componentDimensions.gutterHorizontal,paddingVertical:e.spaces.space16},content:{flexGrow:1,flexShrink:1},icon:{color:e.colors.gray700,paddingStart:e.spaces.space12,flexShrink:0},noResult:{paddingHorizontal:e.componentDimensions.gutterHorizontal,paddingVertical:e.spaces.space16},itemPadding:{paddingHorizontal:e.componentDimensions.gutterHorizontal,paddingVertical:e.componentDimensions.gutterVertical},loaded:{opacity:1},focused:{backgroundColor:e.colors.gray0},transitionStyles:{transitionProperty:"opacity",transitionDuration:"250ms",opacity:0}}))),le=({isSelected:e})=>e?i.createElement(d.Z,{accessibilityHidden:!0,style:ae.checkIcon}):null},6800:(e,t,s)=>{s.d(t,{o:()=>o});var i=s(16742);const o=(0,i.Z)([]);(0,i.Z)({})},79075:(e,t,s)=>{s.d(t,{Ci:()=>c,Dd:()=>l,NW:()=>r,Ur:()=>a,WX:()=>i,jF:()=>d,kl:()=>o,nQ:()=>n});const i="ArrowDown",o="ArrowUp",r="Enter",n="Escape",a="ESC",l="Tab",d="Delete",c="Backspace"},92157:(e,t,s)=>{s.d(t,{x:()=>o});var i=s(34562);const o=(e,t)=>e[i.Yf]?e[i.Yf].conversations[t]:null},10891:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(2784),o=s(90601),r=s(73569);const n=(e={})=>(0,o.Z)("svg",{...e,accessibilityRole:e.accessibilityLabel?e.accessibilityRole||"img":void 0,accessibilityHidden:void 0===e.accessibilityLabel,style:[r.Z.root,e.style],viewBox:"0 0 21 21",children:i.createElement("g",null,i.createElement("path",{d:"M9.094 3.095c-3.314 0-6 2.686-6 6s2.686 6 6 6c1.657 0 3.155-.67 4.243-1.757 1.087-1.088 1.757-2.586 1.757-4.243 0-3.314-2.686-6-6-6zm-9 6c0-4.971 4.029-9 9-9s9 4.029 9 9c0 1.943-.617 3.744-1.664 5.215l4.475 4.474-2.122 2.122-4.474-4.475c-1.471 1.047-3.272 1.664-5.215 1.664-4.97-.001-8.999-4.03-9-9z"}))});n.metadata={width:21,height:21};const a=n}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/shared~loader.Typeahead~bundle.Communities~bundle.Delegate~bundle.Ocf~bundle.LoggedOutHome~bundle.Search~bund.d6bdeac9.js.map